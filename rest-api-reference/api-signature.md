# Signature
`securityKey` is generated by cpay.

## PHP

```php

function genSignature($params, $securityKey) {
  if (!is_array($params) || count($params) == 0) {
    return '';
  }

  ksort($params);
  $qs = '';
  foreach ($params as $k => $v) {
    if (!empty($v)) {
      $qs = $qs . "{$k}={$v}&";
    }
  }
  // $qs='amount=100&createTime=1658387195&cryptoCurrency=USDT&fiatCurrency=USD&merchantId=20000387&merchantTradeNo=test0001&purchaseType=1&userId=83453&key=xxx112233'
  $qs = $qs.'key='.$securityKey;
  return hash_hmac("sha256", $qs, $securityKey);
}

// using
$params = [
  'amount' => '100',
  'merchantTradeNo' => 'test0001',
  'merchantId' => 20000387,
  'createTime' => 1658387195,
  'fiatCurrency' => 'USD',
  'userId' => '83453',
  'cryptoCurrency' => 'USDT',
  'purchaseType' => 1
];
$sign = genSignature($params, 'xxx112233');

// e20a671567201e793c794efedd7794be770aedef4291383f46d1974165445bf0
echo $sign;

```
## Golang

```go

package main

import (
	"crypto/hmac"
	"crypto/sha256"
	"encoding/hex"
	"fmt"
	"sort"

	"github.com/shopspring/decimal"
)

func GenSignature(p map[string]interface{}, securityKey string) string {
	delete(p, "sign")

	counter := len(p)
	ks := make([]string, 0, counter)
	for k := range p {
		ks = append(ks, k)
	}
	sort.Strings(ks)

	qs := ""
	for i := 0; i < counter; i++ {
		var s = p[ks[i]]
		tmp := fmt.Sprintf("%v", s)

		switch s.(type) {
		case int64, int, float64:
			ss, _ := decimal.NewFromString(tmp)
			tmp = ss.String()
		}
		if len(tmp) > 0 {
			qs += ks[i] + "=" + tmp + "&"
		}
	}

	// qs="amount=100&createTime=1658387195&cryptoCurrency=USDT&fiatCurrency=USD&merchantId=20000387&merchantTradeNo=test0001&purchaseType=1&userId=83453&key=xxx112233"
	qs = qs + fmt.Sprintf("key=%s", securityKey)
	h := hmac.New(sha256.New, []byte(securityKey))
	h.Write([]byte(qs))
	return hex.EncodeToString(h.Sum(nil))
}

// using
params := make(map[string]interface{})
params["amount"] = "100"
params["merchantTradeNo"] = "test0001"
params["merchantId"] = 20000387
params["createTime"] = 1658387195
params["fiatCurrency"] = "USD"
params["cryptoCurrency"] = "USDT"
params["userId"] = "83453"
params["purchaseType"] = 1
sign := GenSignature(params, "xxx112233")

// e20a671567201e793c794efedd7794be770aedef4291383f46d1974165445bf0
fmt.Println(sign)

```

## Java
```java
package com.xxx.demo;

import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;
import java.util.*;

public class Demo {
    public static void main(String[] args) {
        Map<String, Object> params = new HashMap<>();
        params.put("merchantTradeNo", "test0001");
        params.put("merchantId", 20000387);
        params.put("userId", "83453");
        params.put("amount", "100");
        params.put("fiatCurrency", "USD");
        params.put("cryptoCurrency", "USDT");
        params.put("purchaseType", "1");
        params.put("createTime", 1658387195);
        try {
            String sign = genSignature(params, "xxx112233");

            // e20a671567201e793c794efedd7794be770aedef4291383f46d1974165445bf0
            System.out.println(sign);
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public static String genSignature(Map<String, Object> params, String securityKey) throws Exception {
        if (params.isEmpty()) {
            throw new Exception("invalid params");
        }
        Collection<String> keySet = params.keySet();
        List<String> list = Lists.newArrayList(keySet);
        Collections.sort(list);
        StringBuilder sb = new StringBuilder();
        for (String s : list) {
            sb.append(s).append("=").append(params.get(s)).append("&");
        }
        sb.append("key=").append(securityKey);
        // sb.toString() = "amount=100&createTime=1658387195&cryptoCurrency=USDT&fiatCurrency=USD&merchantId=20000387&merchantTradeNo=test0001&purchaseType=1&userId=83453&key=xxx112233"

        Mac sha256HMAC = Mac.getInstance("HmacSHA256");
        SecretKeySpec secretKey = new SecretKeySpec(securityKey.getBytes("UTF-8"), "HmacSHA256");
        sha256HMAC.init(secretKey);
        byte[] array = sha256HMAC.doFinal(sb.toString().getBytes("UTF-8"));

        StringBuilder res = new StringBuilder();
        for (byte item : array) {
            res.append(Integer.toHexString((item & 0xFF) | 0x100).substring(1, 3));
        }
        return res.toString();
    }
}
```
